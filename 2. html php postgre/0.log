mi-app/
â”œâ”€â”€ frontend/        â† HTML / CSS / JS (HOST)
â”œâ”€â”€ backend/         â† Laravel (HOST)
â”œâ”€â”€ docker/
â”‚   â””â”€â”€ php/         â† Dockerfile PHP
        nginx/default.conf
â””â”€â”€ docker-compose.yml

ðŸŸ¢ PASO 1 â€” Crear la carpeta del proyecto (HOST)
mkdir mi-app
cd mi-app


ðŸŸ¢ PASO 2 â€” Crear el FRONTEND (HOST) desde mi-app
mkdir frontend
nano frontend/index.html
    >  <h1>Hola desde el Frontend</h1>


ðŸŸ¢ PASO 3 â€” Crear el BACKEND Laravel (HOST) desde mi-app
mkdir backend

docker run --rm -it -v $(pwd)/backend:/app composer create-project laravel/laravel .


ðŸŸ¢ PASO 4 â€” Crear Dockerfile para PHP (ENTORNO)
mkdir -p docker/php
nano docker/php/Dockerfile
    >   FROM php:8.3-fpm

        # Instalar dependencias necesarias para Laravel + PostgreSQL
        RUN apt-get update && apt-get install -y \
          libpq-dev \
          unzip \
          git \
          curl \
         supervisor \
        && docker-php-ext-install pdo pdo_pgsql

        WORKDIR /var/www/html



4.5 docker/nginx/default.conf
server {
    listen 80;
    server_name localhost;

    root /var/www/html/public;

    index index.php index.html index.htm;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass backend:9000;  # Se conecta al contenedor PHP-FPM
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}




ðŸŸ¢ PASO 5 â€” Crear docker-compose.yml (ORQUESTADOR)
nano docker-compose.yml

version: "3.9"

services:
  # Frontend HTML/JS/CSS
  frontend:
    image: nginx:alpine
    ports:
      - "8080:80"                  # Host localhost:8080 â†’ contenedor 80
    volumes:
      - ./frontend:/usr/share/nginx/html
    restart: always

  # Backend Laravel + PHP-FPM
  backend:
    build: ./docker/php             # Dockerfile con PHP-FPM
    volumes:
      - ./backend:/var/www/html     # CÃ³digo Laravel montado desde host
    expose:
      - "9000"                      # Solo accesible desde otros contenedores (Nginx)
    restart: always

  # Nginx para Laravel
  nginx:
    image: nginx:alpine
    ports:
      - "8000:80"                   # Host localhost:8000 â†’ contenedor Nginx
    volumes:
      - ./backend:/var/www/html
      - ./docker/nginx/default.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - backend
    restart: always

  # Base de datos PostgreSQL
  db:
    image: postgres:16
    environment:
      POSTGRES_DB: appdb
      POSTGRES_USER: appuser
      POSTGRES_PASSWORD: secret
    volumes:
      - pgdata:/var/lib/postgresql/data
    restart: always

volumes:
  pgdata:





ðŸŸ¢ PASO 6 â€” Arrancar TODO
docker-compose up -d


ðŸŸ¢ PASO 7 â€” Verificar que todo funciona
http://localhost:8080
